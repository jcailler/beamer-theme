\RequirePackage{listings}
\RequirePackage{lstautogobble}
\RequirePackage{relsize}


\definecolor{listingsbg}{HTML}{fafaf7}


\colorlet{keywordcolor}{pink}
\colorlet{symbolcolor}{pink}
\colorlet{sortcolor}{orange}
\colorlet{tacticcolor}{blue}
\colorlet{attributecolor}{mint}
\colorlet{commentcolor}{gray}
\colorlet{stringcolor}{green}

\lstset{
	% Spaces are not displayed as a special character
	showstringspaces=false,
	% keep spaces
	keepspaces=true,
	% Size of tabulations
	tabsize=2,
	% Enables ASCII chars 128 to 255
	extendedchars=false,
	% Case sensitivity
	sensitive=true,
	% Automatic breaking of long lines
	breaklines=true,
	breakatwhitespace=true,
	% Default style fors listingsred
	basicstyle=\ttfamily\footnotesize,
	% Position of captions is bottom
	captionpos=b,
	% Full flexible columns
	columns=[l]fullflexible,
	% Style for (listings') identifiers
	identifierstyle=\color{black},
	% Note : highlighting of Coq identifiers is done through a new
	% delimiter definition through an lstset at the beginning of the
	% document. Don't know how to do better.
	% Style for declaration keywords
	keywordstyle=[1]{\color{keywordcolor}},
	% Style for sorts
	keywordstyle=[2]{\color{sortcolor}},
	% Style for tactics keywords
	keywordstyle=[3]{\color{tacticcolor}},
	% Style for attributes
	keywordstyle=[4]{\color{attributecolor}},
	% Style for strings
	stringstyle={\color{stringcolor}},
	% Style for comments
	commentstyle={\smaller\itshape\color{commentcolor}},
	% --> We use `mdframed` for this instead <--
	% backgroundcolor=\color{listingsbg},
	% rulecolor=\color{listingsbg!70!black},
	% frame=l,
	% % frameround=tttt,
	% % framextopmargin=10pt,
	% % framexbottommargin=10pt,
	% framerule=3pt,
	% framesep=8pt,
	% Automatically gobble based on first line
	autogobble=true,
}

\BeforeBeginEnvironment{lstlisting}{%
	\mdleftrule[
		linecolor={listingsbg!60!black},
		backgroundcolor={listingsbg},
		innerbottommargin=3pt]%
}
\AfterEndEnvironment{lstlisting}{%
	\endmdleftrule%
}

\let\oldlstinputlisting\lstinputlisting
\newcommand\rainbow@newlstinputlisting[2][]{
	\begin{mdleftrule}[linecolor={listingsbg!60!black},
			backgroundcolor={listingsbg},
			innerbottommargin=3pt]
		\oldlstinputlisting[#1]{#2}
	\end{mdleftrule}
}
\renewcommand*\lstinputlisting{\@ifstar\oldlstinputlisting\rainbow@newlstinputlisting}


\newcommand\rainbow@lo@dlisting[1]{%
	\StrCut{#1}{=}\lang\file
	\IfStrEq{\file}{\@empty}{}{%
		\RequirePackage{\file}
	}
	\lstloadlanguages{\lang}
}
\@for\entry:=\rainbow@listings\do{%
	\rainbow@lo@dlisting{\entry}
}