\RequirePackage{xstring}
\RequirePackage{graphicx}
% \RequirePackage{transparent}

%% Remove navigation symbols at the bottom of each slide
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{headline}{}

% \setbeamertemplate{background}{%
%     \transparent{0.05}%
%     \includegraphics[trim={5cm 5cm 0 0}, clip, width=\paperwidth, height=\paperheight]{assets/background}
% }

\pgfdeclareverticalshading{rainbow}{100bp}{%
	color(0bp)=(red); color(25bp)=(red); color(33bp)=(yellow);
	color(41bp)=(green); color(49bp)=(blue); color(57bp)=(darkblue);
	color(65bp)=(violet); color(75bp)=(purple); color(100bp)=(purple)
}

\setbeamertemplate{title page}{%
	\let\beamer@andtitle\beamer@andother%
	\let\beamer@andinst\beamer@andother%
	\newbox\internal@titlebox%
	\newbox\internal@subtitlebox%
	\newbox\internal@authorinstbox%
	\newbox\internal@datebox%
	%
	\setbox\internal@titlebox\hbox to \linewidth{%
		\usebeamerfont*{title}%
		\usebeamercolor*[fg]{title}%
		\vbox to 5.8ex{\vfil\inserttitle\vfil\null}}%
	\setbox\internal@subtitlebox\hbox to \linewidth{%
		\usebeamerfont*{subtitle}%
		\usebeamercolor*[fg]{subtitle}%
		\vbox to 3.8ex{\vfil\insertsubtitle\vfil\null}%
	}%
	\setbox\internal@authorinstbox\hbox to \linewidth{\vbox to 8ex{%
				\vfil%
				\begin{minipage}{.6\linewidth}%
					\vbox to 1.2ex{\usebeamerfont*{author}\usebeamercolor*[fg]{author}\insertauthor}%
				\end{minipage}\hfil\begin{minipage}{.4\linewidth}%
					\vbox to 1.2ex{\vfil\usebeamerfont*{author}\usebeamercolor*[fg]{author}\begin{flushright}\insertinstitute\end{flushright}\vfil\null}%
				\end{minipage}%
				\vfil\null%
			}}%
	\setbox\internal@datebox\hbox to .4\linewidth{%
		\usebeamerfont*{titlepage date}%
		\usebeamercolor*[fg]{titlepage date}%
		\vbox to 1ex{\insertdate}%
	}%
	%
	\box\internal@titlebox\par%
	\box\internal@subtitlebox\par%
	\tikz{%
		\shade[shading=rainbow, shading angle=-90] (0, 0) rectangle (\linewidth, 2pt);
	}\par%
	\box\internal@authorinstbox\par%
	\vspace*{1ex}%
	\box\internal@datebox\par%

	\vfill%

	\begin{minipage}{\linewidth}
		\begingroup
		\null
		\hfill%
		\def\and{\hfill}\inserttitlegraphic%
		\hfill%
		\null
		\endgroup
	\end{minipage}
}

\def\progressbarht{2pt}
\newlength{\progressbarwd}
\setbeamertemplate{frametitle}{%
	\nointerlineskip%
	%
	\newbox\internal@titlebox%
	\newbox\internal@subtitlebox%
	\newbox\internal@pagecountbox%
	%
	\setbox\internal@titlebox\vbox to 1.8em{\vfil\hbox{\hspace*{2.5mm}\usebeamerfont{frametitle}\strut\insertframetitle}\vfil}%
	\setbox\internal@subtitlebox\vbox to 1.8em{\vfil\hbox{\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\strut\insertframesubtitle\hspace*{3mm}}\vfil}%
	\setbox\internal@pagecountbox\vbox to \progressbarht{\hbox to \paperwidth{%
			\IfInteger{\insertframenumber}{%
				\ifnum\insertframenumber0>0%
					\setlength{\progressbarwd}{\dimexpr(\paperwidth*\insertframenumber/\inserttotalframenumber)}%
				\else%
					\setlength{\progressbarwd}{\paperwidth}%
				\fi%
			}{%
				\setlength{\progressbarwd}{\paperwidth}%
			}%
			\tikz{%
				\clip (0, 0) rectangle (\progressbarwd, \progressbarht);
				\shade[shading=rainbow, shading angle=-90] (0, 0) rectangle (\paperwidth, \progressbarht);
			}%
		}}%
	%
	\begin{beamercolorbox}[ht=1.8em,wd=\paperwidth]{frametitle}%
		\vspace*{-1pt}%
		\box\internal@titlebox%
		\hfill%
		\box\internal@subtitlebox%
	\end{beamercolorbox}%
	\vspace*{-16.1pt}%
	\begin{beamercolorbox}[wd=\paperwidth,ht=\progressbarht]{}
		\box\internal@pagecountbox%
	\end{beamercolorbox}%
}
\setbeamertemplate{frametitle continuation}[from second][\insertcontinuationtext]

\setbeamertemplate{footline}{%
	\nointerlineskip%
	%
	{\tikz{%
			\shade[shading=rainbow, shading angle=-90] (0, 0) rectangle (\paperwidth, 1pt);
		}}%

	\begin{beamercolorbox}[wd=\paperwidth,ht=2.75ex,dp=1.5ex]{footline}
		\newbox\internal@authorbox%
		\newbox\internal@titlebox%
		\newbox\internal@pagebox%
		%
		\setbox\internal@authorbox\vbox to 1.5ex{\vfil\hbox to .28\paperwidth{\hfil\insertshortauthor\hfil}\vfil}%
		\setbox\internal@titlebox\vbox to 1.5ex{\vfil\hbox{\insertshorttitle}\vfil}%
		\setbox\internal@pagebox\vbox to 1.5ex{\vfil\hbox to 2em{\hfil\insertframenumber\hfil}\vfil}%
		%
		% \hspace*{1mm}%
		\box\internal@authorbox%
		\hfill%
		\box\internal@titlebox%
		\hfill%
		\box\internal@pagebox%
		\hspace*{1.5mm}%
	\end{beamercolorbox}%
}